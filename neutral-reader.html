<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neutral Reader Prototype</title>
    <link rel="stylesheet" href="neutral-reader.css">
</head>
<body data-state="1">
    <!-- Step Controller -->
    <div class="step-controller">
        <button id="prev">Prev</button>
        <button id="next">Next</button>
        <button id="reset">Reset</button>
    </div>

    <!-- Facebook Post Container -->
    <div class="facebook-container">
        <!-- Post Header -->
        <div class="post-header">
            <div class="post-header-left">
                <div class="user-avatar user1">NM</div>
                <div class="post-info">
                    <h3 class="user-name">Nguy·ªÖn Minh</h3>
                    <div class="post-time">
                        <span>38 ph√∫t</span>
                        <i class="fas fa-globe-americas"></i>
                    </div>
                </div>
            </div>
            <div class="post-header-right">
                <button class="more-options">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
                <button class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Post Content -->
        <div class="post-content">
            <p class="post-text">U·ªëng say th√¨ nh√≥t th√¢u üç∫üç∫</p>
        </div>

        <!-- News Article Card -->
        <a href="https://vnexpress.net/hiep-dam-be-gai-say-ruou-4566478.html" target="_blank" class="news-card-link">
            <div class="news-card">
                <div class="news-image">
                    <img src="images/news-thumbnail.jpg" alt="X√¢m h·∫°i t√¨nh d·ª•c b√© g√°i say r∆∞·ª£u" class="news-thumbnail">
                </div>
                <div class="news-content">
                    <div class="news-source">VNEXPRESS.NET</div>
                    <div class="news-title-container">
                        <h2 class="news-title" id="headline">X√¢m h·∫°i t√¨nh d·ª•c <span class="nr-grey nr-underline" id="grey-phrase">b√© g√°i say r∆∞·ª£u</span></h2>
                        <div id="nr-badge" role="button" tabindex="0" aria-label="Xem g·ª£i √Ω trung l·∫≠p">NR!</div>
                        
                        <!-- Popover -->
                        <div id="nr-popover" aria-live="polite">
                            <div class="popover-row">
                                <div class="popover-label">Original</div>
                                <div class="popover-text">X√¢m h·∫°i t√¨nh d·ª•c <span class="nr-grey nr-underline">b√© g√°i say r∆∞·ª£u</span></div>
                            </div>
                            <div class="popover-arrow">‚Üí</div>
                            <div class="popover-row">
                                <div class="popover-label">Neutral</div>
                                <div class="popover-text">C∆° quan ch·ª©c nƒÉng ƒëi·ªÅu tra c√°o bu·ªôc t·∫•n c√¥ng t√¨nh d·ª•c m·ªôt b√© g√°i</div>
                            </div>
                            <div class="popover-row">
                                <div class="popover-label">Annotations</div>
                                <ul class="annotation-list">
                                    <li>Kh√¥ng ƒë∆∞a tr·∫°ng th√°i c·ªßa n·∫°n nh√¢n v√†o ti√™u ƒë·ªÅ khi kh√¥ng c·∫ßn cho vi·ªác hi·ªÉu h√†nh vi</li>
                                    <li>Ti√™u ƒë·ªÅ t·∫≠p trung v√†o h√†nh vi v√† ti·∫øn tr√¨nh ƒëi·ªÅu tra, gi·ªØ nguy√™n s·ª± ki·ªán</li>
                                </ul>
                            </div>
                            <div class="popover-buttons">
                                <button class="popover-button" id="share-btn">Share</button>
                                <button class="popover-button secondary" id="close-btn">Close</button>
                            </div>
                        </div>
                    </div>
                    <p class="news-description">Phan VƒÉn ƒê·∫πp, 21 tu·ªïi, b·ªã c√°o bu·ªôc l·ª£i d·ª•ng l√∫c b√© g√°i 15 tu·ªïi say r∆∞·ª£u ƒë·ªÉ c√≥ h√†nh vi hi·∫øp d√¢m.</p>
                </div>
            </div>
        </a>

        <!-- Engagement Stats -->
        <div class="engagement-stats">
            <div class="reactions">
                <div class="reaction-icons">
                    <span class="reaction like">üëç</span>
                    <span class="reaction love">‚ù§Ô∏è</span>
                    <span class="reaction haha">üòÜ</span>
                </div>
                <span class="reaction-count">B·∫°n v√† 3 ng∆∞·ªùi kh√°c</span>
            </div>
            <div class="comments-shares">
                <span class="comment-count">6 b√¨nh lu·∫≠n</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn like-btn">
                <i class="far fa-thumbs-up"></i>
                <span>Th√≠ch</span>
            </button>
            <button class="action-btn comment-btn">
                <i class="far fa-comment"></i>
                <span>B√¨nh lu·∫≠n</span>
            </button>
            <button class="action-btn share-btn">
                <i class="far fa-share"></i>
                <span>Chia s·∫ª</span>
            </button>
        </div>

        <!-- Comments Section -->
        <div class="comments-section">
            <div class="comments-header">
                <span>Ph√π h·ª£p nh·∫•t</span>
                <i class="fas fa-chevron-down"></i>
            </div>

            <!-- Comment 1 -->
            <div class="comment">
                <div class="comment-avatar user2">TP</div>
                <div class="comment-content">
                    <div class="comment-bubble">
                        <strong>Nguyen Thanh Phung</strong>
                        <p>X·ª©ng ƒë√°ng</p>
                    </div>
                    <div class="comment-actions">
                        <span class="comment-time">41 ph√∫t</span>
                        <button class="comment-action">Th√≠ch</button>
                        <button class="comment-action">Tr·∫£ l·ªùi</button>
                    </div>
                </div>
            </div>

            <!-- Comment 2 -->
            <div class="comment">
                <div class="comment-avatar user3">HP</div>
                <div class="comment-content">
                    <div class="comment-bubble">
                        <strong>H·ªìng Ph√∫c</strong>
                        <p>Say r∆∞·ª£u r·ªìi th√¨ ch·ªãu th√¥i</p>
                    </div>
                    <div class="comment-actions">
                        <span class="comment-time">41 ph√∫t</span>
                        <button class="comment-action">Th√≠ch</button>
                        <button class="comment-action">Tr·∫£ l·ªùi</button>
                    </div>
                </div>
            </div>

            <!-- Comment 3 -->
            <div class="comment">
                <div class="comment-avatar user4">HP</div>
                <div class="comment-content">
                    <div class="comment-bubble">
                        <strong>H·ªìng Ph√∫c</strong>
                        <p>V·ª©a l·∫Øm</p>
                    </div>
                    <div class="comment-actions">
                        <span class="comment-time">41 ph√∫t</span>
                        <button class="comment-action">Th√≠ch</button>
                        <button class="comment-action">Tr·∫£ l·ªùi</button>
                    </div>
                </div>
            </div>

            <!-- Comment 4 -->
            <div class="comment">
                <div class="comment-avatar user5">Pƒê</div>
                <div class="comment-content">
                    <div class="comment-bubble">
                        <strong>Ph∆∞∆°ng ƒêƒÉng</strong>
                        <p>Ch·∫£ hi·ªÉu b√¢y gi·ªù tr·∫ª nghƒ© g√¨</p>
                        <p>ƒê√£ ch∆°i khuy√° c√≤n say x·ªân th√¨ r·∫±ng ch·ªãu th√¥i</p>
                    </div>
                    <div class="comment-actions">
                        <span class="comment-time">30 ph√∫t</span>
                        <button class="comment-action">Haha</button>
                        <button class="comment-action">Tr·∫£ l·ªùi</button>
                        <span class="reaction-emoji">üòÜ</span>
                    </div>
                </div>
            </div>

            <!-- Comment 5 -->
            <div class="comment">
                <div class="comment-avatar user6">MC</div>
                <div class="comment-content">
                    <div class="comment-bubble">
                        <strong>Mai C∆∞·ªùng</strong>
                        <p>Ch·ªâ n√†y n√≥i ƒë√∫ng √Ω tui üòÇ +1 like</p>
                    </div>
                    <div class="comment-actions">
                        <span class="comment-time">3 ph√∫t</span>
                        <button class="comment-action">Th√≠ch</button>
                        <button class="comment-action">Tr·∫£ l·ªùi</button>
                    </div>
                </div>
            </div>

            <!-- Write Comment -->
            <div class="write-comment">
                <div class="comment-avatar user1">NM</div>
                <div class="comment-input-container">
                    <input type="text" placeholder="B√¨nh lu·∫≠n d∆∞·ªõi t√™n Nguy·ªÖn Minh" class="comment-input">
                    <div class="comment-input-actions">
                        <button class="emoji-btn">üòä</button>
                        <button class="camera-btn">üì∑</button>
                        <button class="gif-btn">GIF</button>
                        <button class="sticker-btn">üòÄ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div id="share-modal" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Chia s·∫ª b√†i vi·∫øt</div>
                <button class="modal-close" id="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <textarea class="composer-textarea" id="composer-text" placeholder="B·∫°n ƒëang nghƒ© g√¨?">Original: X√¢m h·∫°i t√¨nh d·ª•c b√© g√°i say r∆∞·ª£u
Neutral: C∆° quan ch·ª©c nƒÉng ƒëi·ªÅu tra c√°o bu·ªôc t·∫•n c√¥ng t√¨nh d·ª•c m·ªôt b√© g√°i</textarea>
            </div>
            <div class="modal-footer">
                <button class="modal-button secondary" id="modal-cancel">Cancel</button>
                <button class="modal-button primary" id="modal-post">Post</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast">ƒê√£ chia s·∫ª phi√™n b·∫£n trung l·∫≠p</div>

    <script>
        // State management
        let currentState = 1;
        const maxState = 5;

        // Elements
        const body = document.body;
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const resetBtn = document.getElementById('reset');
        const nrBadge = document.getElementById('nr-badge');
        const shareBtn = document.getElementById('share-btn');
        const closeBtn = document.getElementById('close-btn');
        const shareModal = document.getElementById('share-modal');
        const modalClose = document.getElementById('modal-close');
        const modalCancel = document.getElementById('modal-cancel');
        const modalPost = document.getElementById('modal-post');
        const toast = document.getElementById('toast');

        // State machine
        function setState(newState) {
            if (newState < 1) newState = 1;
            if (newState > maxState) newState = maxState;
            
            currentState = newState;
            body.setAttribute('data-state', newState.toString());
            
            // Update button states
            prevBtn.disabled = currentState === 1;
            nextBtn.disabled = currentState === maxState;
            
            console.log('State changed to:', currentState);
        }

        // Event listeners
        prevBtn.addEventListener('click', () => setState(currentState - 1));
        nextBtn.addEventListener('click', () => setState(currentState + 1));
        resetBtn.addEventListener('click', () => setState(1));

        // Badge click - move to state 4 if in state 2 or 3
        function handleBadgeClick() {
            if (currentState === 2 || currentState === 3) {
                setState(4);
            }
        }

        nrBadge.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            handleBadgeClick();
        });
        nrBadge.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                e.stopPropagation();
                handleBadgeClick();
            }
        });

        // Popover buttons
        shareBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            setState(5); // This closes the popover and shows the modal
        });
        closeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            setState(2);
        });

        // Prevent popover clicks from bubbling to the news link
        const nrPopover = document.getElementById('nr-popover');
        nrPopover.addEventListener('click', (e) => {
            e.stopPropagation();
        });

        // Modal buttons
        modalClose.addEventListener('click', () => setState(4));
        modalCancel.addEventListener('click', () => setState(4));
        
        modalPost.addEventListener('click', () => {
            // Show toast
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
                setState(2);
            }, 2000);
        });

        // Modal overlay click to close
        shareModal.addEventListener('click', (e) => {
            if (e.target === shareModal) {
                setState(4);
            }
        });

        // Focus management for modal
        function trapFocus(modal) {
            const focusableElements = modal.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];

            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstElement) {
                            e.preventDefault();
                            lastElement.focus();
                        }
                    } else {
                        if (document.activeElement === lastElement) {
                            e.preventDefault();
                            firstElement.focus();
                        }
                    }
                }
                if (e.key === 'Escape') {
                    setState(4);
                }
            });
        }

        // Initialize focus trap for modal
        trapFocus(shareModal);

        // Initialize state
        setState(1);

        // Auto-advance to state 3 when in state 2 (for demo purposes)
        // This simulates the "hover pulse" suggestion
        setInterval(() => {
            if (currentState === 2) {
                setState(3);
            }
        }, 3000);
    </script>
</body>
</html>
